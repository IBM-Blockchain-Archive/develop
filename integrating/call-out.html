<!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->
<!doctype html>
<html lang="en">
<!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->
  
  
  

<head>
  <meta charset="utf-8">
  
    <title>Calling external HTTP or REST services | Hyperledger Composer</title>
  
  <meta name="viewport" content="width=device-width">
  <link rel="icon" type="image/x-icon" href="/develop/favicon.ico">
  <meta name="google-site-verification" content="fBQRJ6h7MV7_TJ7grbgq4P-d-07NRfDWPe4pqEEoH5w">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  

  
    <link href="/develop/assets/css/normalize.css" rel="stylesheet">
    <link href="/develop/assets/css/new-style.min.css" rel="stylesheet">
    <link href="/develop/assets/css/grid-layout.min.css" rel="stylesheet">
    <link href="/develop/assets/css/duo.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.0/clipboard.min.js"></script>
  

  
</head>


<body class="">

  
  <!-- % include navbar.html % -->
  

  <div class="SiteWrapper">
    
      <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->
<div class="content">
    <article class="docs-container">
        <!-- If there's a sidebar, divide into 2 columns -->
        
        <div class="page-sidebar-grid" id="off-canvas">
          <!-- <a class="toggle close" href="#">close</a> -->
          <div class="docs-pagenav-grid">
            <!-- Navigation -->
  <nav class="navbar-docs" role="navigation">
        <!-- Just show the product name -->
            <p class="navbar-brand">IBM Blockchain Platform: <b>Develop</b></p>

</nav>

          </div>

          <select id="version" name="version" onchange="location = this.options[this.selectedIndex].value;">
              <option>Select version</option>
              <option value="/composer/latest/introduction/introduction.html" title="The most stable version of Composer">Latest</option>
              <option value="/composer/unstable/introduction/introduction.html" title="The version that will replace Latest">Latest-unstable</option>
          </select>

            <div class="search-form">
              <form action="/develop/search/search.html" method="get">
                <!-- <label for="search-box">Search</label> -->

                <input type="text" id="search-box"  class="search-box" name="query" placeholder="Search here...">
                <input type="submit" class="submit-input hide" value="">

                <div class="search-icon">
                  <img src="/develop/assets/img/Search_Icon_1.svg" class="trigger" type="submit">
                </div>
              </form>
            </div>

          <div class="docs-current-page-grid">
          <p>Calling external HTTP or REST services</p>
          </div>

          <nav class="context-nav">
            
            
              <ul>
<li><p><a href="/develop/"><b>Introduction</b><img src="/develop/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/develop/introduction/key-concepts">Key Concepts</a></li>
<li><a href="/develop/introduction/solution-architecture">Typical Solution Architecture</a></li>
</ul></li>
<li><p><a href="/develop/installing/installing-index"><b>Installing</b><img src="/develop/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/develop/installing/installing-prereqs">Installing pre-requisites</a></li>
<li><a href="/develop/installing/development-tools">Installing the development environment</a></li>
<li><a href="/develop/installing/update-dev-env">Updating the development environment</a></li>
<li><a href="/develop/installing/uninstall-dev-env">Uninstalling the development environment</a></li>
</ul></li>
<li><p><a href="/develop/tutorials/tutorials"><b>Tutorials</b><img src="/develop/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/develop/tutorials/playground-tutorial">Playground Tutorial</a></li>
<li><a href="/develop/tutorials/developer-tutorial">Developer Tutorial</a></li>
<li><a href="/develop/tutorials/queries">Queries Tutorial</a></li>
<li><a href="/develop/tutorials/deploy-to-fabric-single-org">Deploying to a single organization Hyperledger Fabric</a></li>
<li><a href="/develop/tutorials/deploy-to-fabric-multi-org">Deploying to a multi-organization Hyperledger Fabric</a></li>
<li><a href="/develop/tutorials/invoke-composer-network">Interacting with other business networks</a></li>
<li><a href="/develop/tutorials/acl-trading">Access Control Tutorial - Commodity Trading</a></li>
<li><a href="/develop/tutorials/google_oauth2_rest">Using Google OAUTH2.0 with a Composer REST server</a></li>
</ul></li>
<li><p><a href="/develop/playground/playground-index"><b>Using Playground</b><img src="/develop/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/develop/playground/id-cards-playground">Business Network Cards</a></li>
</ul></li>
<li><p><a href="/develop/business-network/business-network-index"><b>Developing Business Networks</b><img src="/develop/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/develop/business-network/businessnetworkdefinition">Business Network Definitions</a></li>
<li><a href="/develop/business-network/bnd-create">Create a Business Network Definition</a></li>
<li><a href="/develop/business-network/bnd-deploy">Deploying Business Networks</a></li>
<li><a href="/develop/business-network/publishing-events">Emitting Events</a></li>
<li><a href="/develop/business-network/testing">Testing Business Networks</a></li>
<li><a href="/develop/business-network/bnd-publish">Publish Models or Business Network Definitions</a></li>
<li><a href="/develop/business-network/upgrading-bna">Upgrading a deployed business network</a></li>
<li><a href="/develop/business-network/query">Using Queries and Filters with Business Network Data</a></li>
<li><a href="/develop/business-network/programmatic-access-control">Programmatic access control</a></li>
<li><a href="/develop/business-network/historian">Hyperledger Composer Historian</a></li>
<li><a href="/develop/business-network/cloud-wallets">Customising card stores</a></li>
</ul></li>
<li><p><a href="/develop/applications/applications-index"><b>Developing Applications</b><img src="/develop/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/develop/applications/node">Writing a Node.js application</a></li>
<li><a href="/develop/applications/web">Writing Web applications</a></li>
<li><a href="/develop/applications/subscribing-to-events">Subscribing to events</a></li>
</ul></li>
<li><p><a href="/develop/integrating/integrating-index"><b>Integrating Existing Systems</b><img src="/develop/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/develop/integrating/getting-started-rest-api">Generating a REST API</a></li>
<li><a href="/develop/integrating/publishing-events">Publishing events from the REST server</a></li>
<li><a href="/develop/integrating/enabling-rest-authentication">Enabling authentication for the REST server</a></li>
<li><a href="/develop/integrating/enabling-multiuser">Enabling multiple user mode for the REST server</a></li>
<li><a href="/develop/integrating/securing-the-rest-server">Securing the REST server using HTTPS and TLS</a></li>
<li><a href="/develop/integrating/deploying-the-rest-server">Deploying the REST server for a business network</a></li>
<li><a href="/develop/integrating/node-red">Integrating with Node-RED</a></li>
<li><a href="/develop/integrating/call-out">Calling external HTTP or REST services</a></li>
</ul></li>
<li><p><a href="/develop/managing/managingindex"><b>Managing a Deployed Business Network</b><img src="/develop/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/develop/managing/participantsandidentities">Participants and identities</a></li>
<li><a href="/develop/managing/participant-add">Adding participants</a></li>
<li><a href="/develop/managing/id-cards-playground">Creating, Exporting, and Importing Business Network Cards</a></li>
<li><a href="/develop/managing/identity-issue">Issuing a new identity to a participant</a></li>
<li><a href="/develop/managing/identity-bind">Binding an existing identity to a participant</a></li>
<li><a href="/develop/managing/identity-list">Listing all identities in a business network</a></li>
<li><a href="/develop/managing/identity-revoke">Revoking an identity from a participant</a></li>
<li><a href="/develop/managing/connector-information">Interacting with Hyperledger Fabric</a></li>
</ul></li>
<li><p><a href="/develop/problems/diagnostics"><b>Diagnosing Problems</b><img src="/develop/assets/img/Caret_SW_2.svg" class="caret"></a></p></li>
<li><p><a href="/develop/reference/reference-index"><b>Reference</b><img src="/develop/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/develop/reference/MeetTheModules">Hyperledger Composer npm Modules</a></li>
<li><a href="/develop/reference/cto_language">Modeling Language</a></li>
<li><a href="/develop/reference/acl_language">Access Control Language</a></li>
<li><a href="/develop/reference/query-language">Query Language</a></li>
<li><a href="/develop/reference/model-compatibility">Model Compatibility</a></li>
<li><a href="/develop/reference/connectionprofile">Connection Profiles</a></li>
<li><a href="/develop/reference/js_scripts">Transaction Processor Functions</a></li>
<li><a href="/develop/reference/commands">Hyperledger Composer CLI Commands</a></li>
<li><a href="/develop/reference/rest-server">Hyperledger Composer REST Server</a></li>
<li><a href="/develop/reference/glossary">Hyperledger Composer Glossary of Terms</a></li>
</ul></li>
<li><p><a href="/develop/support/support-index"><b>Support</b><img src="/develop/assets/img/Caret_SW_2.svg" class="caret"></a></p></li>
<li><p><a href="/develop/api/api-doc-index"><b>API Reference</b><img src="/develop/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/develop/api/allData">API Class Index</a></li>
<li><a href="/develop/api/admin-adminconnection">AdminConnection (Admin API)</a></li>
<li><a href="/develop/api/client-assetregistry">AssetRegistry (Client API)</a></li>
<li><a href="/develop/api/client-businessnetworkconnection">BusinessNetworkConnection (Client API)</a></li>
<li><a href="/develop/api/client-historian">Historian (Client API)</a></li>
<li><a href="/develop/api/client-identityregistry">IdentityRegistry (Client API)</a></li>
<li><a href="/develop/api/client-participantregistry">ParticipantRegistry (Client API)</a></li>
<li><a href="/develop/api/client-query">Query (Client API)</a></li>
<li><a href="/develop/api/client-registry">Registry (Client API)</a></li>
<li><a href="/develop/api/client-transactionregistry">TransactionRegistry (Client API)</a></li>
<li><a href="/develop/api/common-assetdeclaration">AssetDeclaration (Common API)</a></li>
<li><a href="/develop/api/common-businessnetworkcardstore">BusinessNetworkCardStore (Common API)</a></li>
<li><a href="/develop/api/common-businessnetworkdefinition">BusinessNetworkDefinition (Common API)</a></li>
<li><a href="/develop/api/common-businessnetworkmetadata">BusinessNetworkMetadata (Common API)</a></li>
<li><a href="/develop/api/common-classdeclaration">ClassDeclaration (Common API)</a></li>
<li><a href="/develop/api/common-conceptdeclaration">ConceptDeclaration (Common API)</a></li>
<li><a href="/develop/api/common-concept">Concept (Common API)</a></li>
<li><a href="/develop/api/common-enumdeclaration">EnumDeclaration (Common API)</a></li>
<li><a href="/develop/api/common-enumvaluedeclaration">EnumValueDeclaration (Common API)</a></li>
<li><a href="/develop/api/common-eventdeclaration">EventDeclaration (Common API)</a></li>
<li><a href="/develop/api/common-factory">Factory (Common API)</a></li>
<li><a href="/develop/api/common-functiondeclaration">FunctionDeclaration (Common API)</a></li>
<li><a href="/develop/api/common-idcard">IdCard (Common API)</a></li>
<li><a href="/develop/api/common-identifiable">Identifiable (Common API)</a></li>
<li><a href="/develop/api/common-introspector">Introspector (Common API)</a></li>
<li><a href="/develop/api/common-modelfile">ModelFile (Common API)</a></li>
<li><a href="/develop/api/common-modelmanager">ModelManager (Common API)</a></li>
<li><a href="/develop/api/common-participantdeclaration">ParticipantDeclaration (Common API)</a></li>
<li><a href="/develop/api/common-property">Property (Common API)</a></li>
<li><a href="/develop/api/common-relationshipdeclaration">RelationshipDeclaration (Common API)</a></li>
<li><a href="/develop/api/common-relationship">Relationship (Common API)</a></li>
<li><a href="/develop/api/common-resource">Resource (Common API)</a></li>
<li><a href="/develop/api/common-serializer">Serializer (Common API)</a></li>
<li><a href="/develop/api/common-transactiondeclaration">TransactionDeclaration (Common API)</a></li>
<li><a href="/develop/api/common-typed">Typed (Common API)</a></li>
<li><a href="/develop/api/common-validatedconcept">ValidatedConcept (Common API)</a></li>
<li><a href="/develop/api/common-validatedresource">ValidatedResource (Common API)</a></li>
<li><a href="/develop/api/runtime-api">Api (Runtime API)</a></li>
<li><a href="/develop/api/runtime-assetregistry">AssetRegistry (Runtime API)</a></li>
<li><a href="/develop/api/runtime-factory">Factory (Runtime API)</a></li>
<li><a href="/develop/api/runtime-participantregistry">ParticipantRegistry (Runtime API)</a></li>
<li><a href="/develop/api/runtime-query">Query (Runtime API)</a></li>
<li><a href="/develop/api/runtime-serializer">Serializer (Runtime API)</a></li>
</ul></li>
<li><p><a href="/develop/systemns/systemns-index"><b>System Namespace Reference</b><img src="/develop/assets/img/Caret_SW_2.svg" class="caret"></a></p>

<ul>
<li><a href="/develop/systemns/01_summary">Summary</a></li>
<li><a href="/develop/systemns/02_assets">Assets</a></li>
<li><a href="/develop/systemns/03_participants">Participants</a></li>
<li><a href="/develop/systemns/04_transactions">Transactions</a></li>
<li><a href="/develop/systemns/05_events">Events</a></li>
<li><a href="/develop/systemns/06_enums">Enums</a></li>
</ul></li>
</ul>

            
                <div class="docs-footer-grid">
                <div class="footer-bg-break docs-footer-break">
<div class="footer-container-break">
    <div class="footer-left-break">
      <p>View the <a href="http://www14.software.ibm.com/cgi-bin/weblap/lap.pl?li_formnum=L-MCAE-ATLKDW&title=IBM%20Blockchain%20Platform:%20Develop">license information</a></p>
    </div>
</div>
</div>

                </div>
          </nav>
        </div>
        <div class="page-content-grid">
          <section class="content-chunk">
            <!-- <a class="toggle open" href="#nav">open</a> -->
            
              <h1 id="calling-an-http-or-rest-api-from-transaction-processor-functions">Calling an HTTP or REST API from Transaction Processor Functions</h1>

<p>In some cases it is desirable to be able to call HTTP or REST APIs from transaction processor functions. This allows you to move complex or expensive computation from the blockchain to a centrally or peer hosted service.</p>

<p>Alternatively, a transaction processor function may wish to call third party HTTP or REST APIs that provides external data. For example, a third party API may provide data about the current price of a stock, or the current weather and temperature, which can be used to determine whether or not the conditions of a contract have been fulfilled.</p>

<p>IBM Blockchain Platform: Develop allows a transaction processor function developer to call an HTTP or REST API from within a transaction processor function.</p>

<blockquote>
<p>Please note that using this function can lead to errors that are caused by consensus failures, and should only be used with care. For more information, see <a href="#consensus-considerations">Consensus considerations</a> below.</p>
</blockquote>

<h2 id="using-the-request-module">Using the request module</h2>

<p>The <code>request</code> module (<a href="https://github.com/request/request">https://github.com/request/request</a>), is a popular HTTP client used by many Node.js applications. IBM Blockchain Platform: Develop embeds the <code>request</code> module, so that transaction processor functions can use it to make calls to HTTP or REST APIs.</p>

<p>The standard <code>request</code> module uses a callback oriented API. However, transaction processor functions are promise based, and callback oriented APIs result in a lot of unnecessary code to wrap the callbacks in promises. To make the experience easier for transaction processor function developers, we have exposed the promise based <code>request-promise</code> module (<a href="https://github.com/request/request-promise">https://github.com/request/request-promise</a>) instead.</p>

<p>The <code>request-promise</code> module is automatically available to all transaction processor functions via the <code>request</code> global variable. You do not need to add the <code>request</code> or <code>request-promise</code> modules to your <code>package.json</code> file, nor do you need to use the <code>require</code> function to load the modules.</p>

<p>The global <code>request</code> method and all of the convenience methods for the various HTTP methods (<code>request.get</code>, <code>request.post</code>, etc.) are available to transaction processor functions. These methods provide a full set of options for handling request bodies, response bodies, HTTP headers, authentication, cookies, proxies, and TLS/SSL.</p>

<p>For detailed information on these methods and the options available, please review the documentation for the <code>request</code> and <code>request-promise</code> modules.</p>

<h2 id="examples">Examples</h2>

<p>Make an HTTP GET request to an HTTP server that returns the current stock price as a string:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/**
 * Buy a given amount of CONGA stocks.
 * @param {org.example.BuyStocks} transaction The transaction.
 * @transaction
 */</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">buyStocks</span><span class="p">(</span><span class="nx">transaction</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Look up the current price of the CONGA stock, and parse it into a float.</span>
    <span class="kd">const</span> <span class="nx">priceAsStr</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'http://stocks.org/CONGA'</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">price</span> <span class="o">=</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">priceAsStr</span><span class="p">);</span>

    <span class="c1">// Get the current participant, and update their stock and balance.</span>
    <span class="kd">const</span> <span class="nx">participant</span> <span class="o">=</span> <span class="nx">getCurrentParticipant</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">units</span> <span class="o">=</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">units</span><span class="p">;</span>
    <span class="nx">participant</span><span class="p">.</span><span class="nx">stockUnits</span> <span class="o">+=</span> <span class="nx">units</span><span class="p">;</span>
    <span class="nx">participant</span><span class="p">.</span><span class="nx">balance</span> <span class="o">-=</span> <span class="nx">price</span> <span class="o">*</span> <span class="nx">units</span><span class="p">;</span>

    <span class="c1">// Update the current participant in the participant registry.</span>
    <span class="kd">const</span> <span class="nx">participantRegistry</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">getParticipantRegistry</span><span class="p">(</span><span class="s1">'org.example.Trader'</span><span class="p">);</span>
    <span class="kr">await</span> <span class="nx">participantRegistry</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">participant</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div>
<p>Make an HTTP GET request to an HTTP server that returns the current stock price as a JSON structure:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/**
 * Buy a given amount of CONGA stocks.
 * @param {org.example.BuyStocks} transaction The transaction.
 * @transaction
 */</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">buyStocks</span><span class="p">(</span><span class="nx">transaction</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Look up the current price of the CONGA stock, and extract the price.</span>
    <span class="c1">// The option "json: true" automatically parses JSON from the HTTP response.</span>
    <span class="kd">const</span> <span class="nx">stock</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">({</span> <span class="na">uri</span><span class="p">:</span> <span class="s1">'http://stocks.org/CONGA'</span><span class="p">,</span> <span class="na">json</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
    <span class="kd">const</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">stock</span><span class="p">.</span><span class="nx">price</span><span class="p">;</span>

    <span class="c1">// Get the current participant, and update their stock and balance.</span>
    <span class="kd">const</span> <span class="nx">participant</span> <span class="o">=</span> <span class="nx">getCurrentParticipant</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">units</span> <span class="o">=</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">units</span><span class="p">;</span>
    <span class="nx">participant</span><span class="p">.</span><span class="nx">stockUnits</span> <span class="o">+=</span> <span class="nx">units</span><span class="p">;</span>
    <span class="nx">participant</span><span class="p">.</span><span class="nx">balance</span> <span class="o">-=</span> <span class="nx">price</span> <span class="o">*</span> <span class="nx">units</span><span class="p">;</span>

    <span class="c1">// Update the current participant in the participant registry.</span>
    <span class="kd">const</span> <span class="nx">participantRegistry</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">getParticipantRegistry</span><span class="p">(</span><span class="s1">'org.example.Trader'</span><span class="p">);</span>
    <span class="kr">await</span> <span class="nx">participantRegistry</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">participant</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div>
<p>Make an HTTP POST request to an HTTP server that includes the current participant as the HTTP request body, and returns the current stock price as a string:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/**
 * Buy a given amount of CONGA stocks.
 * @param {org.example.BuyStocks} transaction The transaction.
 * @transaction
 */</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">buyStocks</span><span class="p">(</span><span class="nx">transaction</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Get the current participant.</span>
    <span class="kd">const</span> <span class="nx">participant</span> <span class="o">=</span> <span class="nx">getCurrentParticipant</span><span class="p">();</span>

    <span class="c1">// Look up the current price of the CONGA stock, and extract the price.</span>
    <span class="c1">// The option "json" sends the participant as the HTTP request body,</span>
    <span class="c1">// and automatically parses JSON from the HTTP response.</span>
    <span class="kd">const</span> <span class="nx">stock</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">request</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span> <span class="na">uri</span><span class="p">:</span> <span class="s1">'http://stocks.org/CONGA'</span><span class="p">,</span> <span class="na">json</span><span class="p">:</span> <span class="nx">participant</span> <span class="p">});</span>
    <span class="kd">const</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">stock</span><span class="p">.</span><span class="nx">price</span><span class="p">;</span>

    <span class="c1">// Get the current participant, and update their stock and balance.</span>
    <span class="kd">const</span> <span class="nx">units</span> <span class="o">=</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">units</span><span class="p">;</span>
    <span class="nx">participant</span><span class="p">.</span><span class="nx">stockUnits</span> <span class="o">+=</span> <span class="nx">units</span><span class="p">;</span>
    <span class="nx">participant</span><span class="p">.</span><span class="nx">balance</span> <span class="o">-=</span> <span class="nx">price</span> <span class="o">*</span> <span class="nx">units</span><span class="p">;</span>

    <span class="c1">// Update the current participant in the participant registry.</span>
    <span class="kd">const</span> <span class="nx">participantRegistry</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">getParticipantRegistry</span><span class="p">(</span><span class="s1">'org.example.Trader'</span><span class="p">);</span>
    <span class="kr">await</span> <span class="nx">participantRegistry</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">participant</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div>
<p>Make an HTTP POST request to an HTTP server that returns a serialized instance of a stock asset:</p>
<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="cm">/**
 * Buy a given amount of CONGA stocks.
 * @param {org.example.BuyStocks} transaction The transaction.
 * @transaction
 */</span>
<span class="k">async</span> <span class="kd">function</span> <span class="nx">buyStocks</span><span class="p">(</span><span class="nx">transaction</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// Look up the current price of the CONGA stock, and extract the price.</span>
    <span class="c1">// The option "json: true" automatically parses JSON from the HTTP response.</span>
    <span class="kd">const</span> <span class="nx">json</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">request</span><span class="p">.</span><span class="kd">get</span><span class="p">({</span> <span class="na">uri</span><span class="p">:</span> <span class="s1">'http://stocks.org/CONGA'</span><span class="p">,</span> <span class="na">json</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>

    <span class="c1">// Parse the JavaScript object into the stock asset.</span>
    <span class="kd">const</span> <span class="nx">serializer</span> <span class="o">=</span> <span class="nx">getSerializer</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">stock</span> <span class="o">=</span> <span class="nx">serializer</span><span class="p">.</span><span class="nx">fromJSON</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
    <span class="kd">const</span> <span class="nx">price</span> <span class="o">=</span> <span class="nx">stock</span><span class="p">.</span><span class="nx">price</span><span class="p">;</span>

    <span class="c1">// Get the current participant, and update their stock and balance.</span>
    <span class="kd">const</span> <span class="nx">participant</span> <span class="o">=</span> <span class="nx">getCurrentParticipant</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">units</span> <span class="o">=</span> <span class="nx">transaction</span><span class="p">.</span><span class="nx">units</span><span class="p">;</span>
    <span class="nx">participant</span><span class="p">.</span><span class="nx">stockUnits</span> <span class="o">+=</span> <span class="nx">units</span><span class="p">;</span>
    <span class="nx">participant</span><span class="p">.</span><span class="nx">balance</span> <span class="o">-=</span> <span class="nx">price</span> <span class="o">*</span> <span class="nx">units</span><span class="p">;</span>

    <span class="c1">// Update the current participant in the participant registry.</span>
    <span class="kd">const</span> <span class="nx">participantRegistry</span> <span class="o">=</span> <span class="kr">await</span> <span class="nx">getParticipantRegistry</span><span class="p">(</span><span class="s1">'org.example.Trader'</span><span class="p">);</span>
    <span class="kr">await</span> <span class="nx">participantRegistry</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">participant</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div>
<h2 id="consensus-considerations">Consensus considerations</h2>

<p>In Hyperledger Fabric, consensus in a business network is achieved by having peer nodes in multiple organisations endorse transactions. Transactions are endorsed by executing chaincode, and signing the results of that execution. In order for the transaction to be committed by the blockchain network, all peer nodes endorsing the transaction must produce the same results from executing chaincode.</p>

<p>When a business network makes an HTTP request using the APIs described above, those HTTP requests will be executed on all peer nodes endorsing the transaction. This will result in <em>n</em> HTTP requests, where <em>n</em> is the number of peer nodes endorsing the transaction.</p>

<p>In order for consensus to be achieved when business networks make HTTP requests, you must be careful to ensure that transaction processor functions make the same HTTP requests on all peer nodes, and then perform the same processing on the HTTP responses on all peer nodes.</p>

<p>For example, consider a business network that uses an HTTP request to look up a stock price from an external symbol. The business network then uses the stock price to adjust the balance on a participants account. If different peer nodes receive different stock prices, then they will attempt to make different adjustments to the balance on the participants account. This will result in a consensus failure, and the transaction being rejected.</p>

<p>HTTP requests may result in different responses for multiple reasons:</p>

<ul>
<li>Peer nodes in different organisations may run in different data centers, in different countries, in different time zones.</li>
<li>Peer nodes in different organisations may not have access to the HTTP server depending on public internet access and firewall restrictions.</li>
<li>Peer nodes in different organisations may authenticate to the HTTP server as different users, resulting in different HTTP responses.</li>
</ul>

<p>In order to minimize the risks of consensus failures when making HTTP requests from a transaction processor function, it is recommended you use make HTTP requests that are either:</p>

<ul>
<li>Safe, in that the HTTP request does not modify any state on the HTTP server.</li>
<li>Idempotent, in that the same HTTP request can be made many times without different outcomes.</li>
</ul>

<h2 id="cors-cross-origin-resource-sharing">CORS (Cross-Origin Resource Sharing)</h2>

<p>Business networks deployed to the Web Browser connection from the IBM Blockchain Platform: Develop Playground run inside the web browser. When transaction processor functions inside these business networks make HTTP requests using the APIs described above, those HTTP requests are handled using the HTTP client built into the web browser.</p>

<p>HTTP clients built into the web browser require that the HTTP server is CORS (Cross-Origin Resource Sharing) compliant. If you deploy business networks to the Web Browser connection, then you must ensure that the HTTP server has been configured to be CORS compliant. For more information, see: <a href="https://enable-cors.org">https://enable-cors.org</a></p>

<h2 id="docker-network-resolution">Docker Network Resolution</h2>

<p>Business networks deployed to Hyperledger Fabric run within a chaincode Docker container. This means that the business networks are subject to the DNS resolution and network services provided by Docker, instead of those services provided by the host machine. Additionally, the chaincode Docker container has its own IP address.</p>

<p>This means that <code>localhost</code> resolves to the chaincode Docker container, rather than the host machine. Any HTTP requests made to <code>localhost</code>, for example <a href="http://localhost:3000/api/Vehicle">http://localhost:3000/api/Vehicle</a>, will not work as expected. The easiest workaround is to use a DNS name for your REST server that is publicly resolvable.</p>

            
          </section>
        </div>
        <!-- Otherwise, have the main content fill all 12 columns... -->
        
      <div class="PageNavigation">
    
    
  </div>
    </article>
</div>
<script>
(function (document) {
    function clipboard_init() {
        var charts = document.querySelectorAll("div.highlight"),
            arr = [],
            i, j, maxItem, pre, btn, el;

        // Make sure we are dealing with an array
        for(i = 0, maxItem = charts.length; i < maxItem; i++) arr.push(charts[i]);

        // Find the UML source element and get the text
        for (i = 0, maxItem = arr.length; i < maxItem; i++) {
            el = arr[i];
            pre = el.childNodes[0];

            pre.id = "hl_code" + i.toString();
            btn = document.createElement('copy-button');
            btn.appendChild(document.createTextNode('Copy'));
            btn.setAttribute("class", "copy-btn");
            btn.setAttribute("data-clipboard-target", "#hl_code" + i.toString());
            el.insertBefore(btn, pre);
        }
        new Clipboard('.copy-btn');
    };

    function onReady(fn) {
        if (document.addEventListener) {
            document.addEventListener('DOMContentLoaded', fn);
        } else {
            document.attachEvent('onreadystatechange', function() {
                if (document.readyState === 'interactive')
                    fn();
            });
        }
    }

    onReady(function(){
        clipboard_init();
    });
})(document);
</script>
<script src="/develop/assets/js/nav.js"></script>
<script src="/develop/assets/js/search_bar.js"></script>

    

    


  </div>
</body>
</html>
